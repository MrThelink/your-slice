<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Your Slice - Your Slice</title>
    <link rel="stylesheet" href="../shared/shared.css">
    <link rel="stylesheet" href="build-your-slice.css">
    <script src="../shared/shared.js" defer></script>
    <script src="build-your-slice.js" defer></script>
    <script>
        // Clear any stuck modification state on page load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Checking for stuck modification state...');
            const modData = localStorage.getItem('modifyingPizza');
            if (modData) {
                console.log('Found modification data on page load:', modData);
            }
        });
    </script>
</head>
<body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <!-- Builder Section -->
    <section id="build-your-slice" class="builder-section container">
        <div class="section-title">
            <h2>Build Your Slice</h2>
            <p>Follow the steps to create your customized pizza slice</p>
        </div>

        <div class="builder-steps">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <p>Base</p>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <p>Sauce</p>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <p>Cheese</p>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <p>Toppings</p>
            </div>
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <p>Size</p>
            </div>
        </div>

        <div class="builder-content">
            <div class="pizza-preview">
                <div class="pizza-canvas" id="pizzaCanvas">
                    <!-- Pizza visualization will be rendered here -->
                    <div class="pizza-base"></div>
                    <div class="pizza-sauce"></div>
                    <div class="pizza-cheese"></div>
                    <div class="pizza-toppings"></div>
                </div>
                <div class="pizza-summary" id="pizzaSummary">
                    <h3>Your Pizza</h3>
                    <div id="selectedOptions"></div>
                    <div class="total-price">Total: <span id="currentPrice">â‚¬6.50</span></div>
                </div>
            </div>
            
            <div class="options-container">
                <!-- Step 1: Base -->
                <div class="step-content active" id="step1">
                    <h3>Select Your Base</h3>
                    <div class="options-grid">
                        <div class="option-card selected" data-type="base" data-name="Original" data-price="0">
                            <img src="../../img/pizza-base-img/base/original.jpeg" alt="Original">
                            <h3>Original</h3>
                            <p>+â‚¬0.00</p>
                        </div>
                        <div class="option-card" data-type="base" data-name="Whole Wheat" data-price="0.5">
                            <img src="../../img/pizza-base-img/base/whole_wheat.jpg" alt="Whole Wheat">
                            <h3>Whole Wheat</h3>
                            <p>+â‚¬0.50</p>
                        </div>
                        <div class="option-card" data-type="base" data-name="Gluten-Free" data-price="1.5">
                            <img src="../../img/pizza-base-img/base/gluten_free.jpg" alt="Gluten-Free">
                            <h3>Gluten-Free</h3>
                            <p>+â‚¬1.50</p>
                        </div>
                        <div class="option-card" data-type="base" data-name="Herb Infused" data-price="0.75">
                            <img src="../../img/pizza-base-img/base/herb_infused.webp" alt="Herb">
                            <h3>Herb Infused</h3>
                            <p>+â‚¬0.75</p>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Sauce (hidden initially) -->
                <div class="step-content" id="step2" style="display: none;">
                    <h3>Select Your Sauce</h3>
                    <div class="options-grid">
                        <div class="option-card" data-type="sauce" data-name="Tomato Sauce" data-price="0">
                            <img src="../../img/pizza-base-img/sauce/tomato_sauce.jpg" alt="Tomato Sauce">
                            <h3>Tomato Sauce</h3>
                            <p>+â‚¬0.00</p>
                        </div>
                        <div class="option-card" data-type="sauce" data-name="BBQ Sauce" data-price="0.5">
                            <img src="../../img/pizza-base-img/sauce/bbq_sauce.jpg" alt="BBQ Sauce">
                            <h3>BBQ Sauce</h3>
                            <p>+â‚¬0.50</p>
                        </div>
                        <div class="option-card" data-type="sauce" data-name="White Sauce" data-price="0.5">
                            <img src="../../img/pizza-base-img/sauce/white_sauce.webp" alt="White Sauce">
                            <h3>White Sauce</h3>
                            <p>+â‚¬0.50</p>
                        </div>
                        <div class="option-card" data-type="sauce" data-name="Pesto" data-price="1">
                            <img src="../../img/pizza-base-img/sauce/pesto_sauce.jpg" alt="Pesto">
                            <h3>Pesto</h3>
                            <p>+â‚¬1.00</p>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Cheese (hidden initially) -->
                <div class="step-content" id="step3" style="display: none;">
                    <h3>Select Your Cheese</h3>
                    <div class="options-grid">
                        <div class="option-card" data-type="cheese" data-name="Mozzarella" data-price="0">
                            <img src="../../img/pizza-base-img/cheese/mozzarella.jpg" alt="Mozzarella">
                            <h3>Mozzarella</h3>
                            <p>+â‚¬0.00</p>
                        </div>
                        <div class="option-card" data-type="cheese" data-name="Cheddar" data-price="0.5">
                            <img src="../../img/pizza-base-img/cheese/cheddar.jpg" alt="Cheddar">
                            <h3>Cheddar</h3>
                            <p>+â‚¬0.50</p>
                        </div>
                        <div class="option-card" data-type="cheese" data-name="Parmesan" data-price="0.75">
                            <img src="../../img/pizza-base-img/cheese/parmesan.jpg" alt="Parmesan">
                            <h3>Parmesan</h3>
                            <p>+â‚¬0.75</p>
                        </div>
                        <div class="option-card" data-type="cheese" data-name="Vegan Cheese" data-price="1">
                            <img src="../../img/pizza-base-img/cheese/vegan_cheese.jpg" alt="Vegan Cheese">
                            <h3>Vegan Cheese</h3>
                            <p>+â‚¬1.00</p>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Toppings (hidden initially) -->
                <div class="step-content" id="step4" style="display: none;">
                    <h3>Select Your Toppings (Select up to 3)</h3>
                    <div class="options-grid">
                        <div class="option-card" data-type="topping" data-name="Pepperoni" data-price="1">
                            <img src="../../img/pizza-base-img/toppings/pepperoni.png" alt="Pepperoni">
                            <h3>Pepperoni</h3>
                            <p>+â‚¬1.00</p>
                        </div>
                        <div class="option-card" data-type="topping" data-name="Mushrooms" data-price="0.75">
                            <img src="../../img/pizza-base-img/toppings/mushrooms.jpg" alt="Mushrooms">
                            <h3>Mushrooms</h3>
                            <p>+â‚¬0.75</p>
                        </div>
                        <div class="option-card" data-type="topping" data-name="Olives" data-price="0.5">
                            <img src="../../img/pizza-base-img/toppings/olives.webp" alt="Olives">
                            <h3>Olives</h3>
                            <p>+â‚¬0.50</p>
                        </div>
                        <div class="option-card" data-type="topping" data-name="Bell Peppers" data-price="0.5">
                            <img src="../../img/pizza-base-img/toppings/pepper.jpg" alt="Bell Peppers">
                            <h3>Bell Peppers</h3>
                            <p>+â‚¬0.50</p>
                        </div>
                        <div class="option-card" data-type="topping" data-name="Onions" data-price="0.5">
                            <img src="../../img/pizza-base-img/toppings/onions.jpg" alt="Onions">
                            <h3>Onions</h3>
                            <p>+â‚¬0.50</p>
                        </div>
                        <div class="option-card" data-type="topping" data-name="Pineapple" data-price="0.75">
                            <img src="../../img/pizza-base-img/toppings/pineapple.jpg" alt="Pineapple">
                            <h3>Pineapple</h3>
                            <p>+â‚¬0.75</p>
                        </div>
                        <div class="option-card" data-type="topping" data-name="Ham" data-price="1">
                            <img src="../../img/pizza-base-img/toppings/ham.jpg" alt="Ham">
                            <h3>Ham</h3>
                            <p>+â‚¬1.00</p>
                        </div>
                        <div class="option-card" data-type="topping" data-name="Chicken" data-price="1.25">
                            <img src="../../img/pizza-base-img/toppings/chicken.jpg" alt="Chicken">
                            <h3>Chicken</h3>
                            <p>+â‚¬1.25</p>
                        </div>
                    </div>
                    <div class="toppings-counter">
                        <span id="selectedToppingsCount">0/3 toppings selected</span>
                    </div>
                </div>

                <!-- Step 5: Size (hidden initially) -->
                <div class="step-content" id="step5" style="display: none;">
                    <h3>Select Your Size</h3>
                    <div class="options-grid">
                        <div class="option-card" data-type="size" data-name="Regular" data-price="0" data-size="regular">
                            <img src="https://images.unsplash.com/photo-1513104890138-7c749659a591?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Regular">
                            <h3>Regular</h3>
                            <p>Base Price: â‚¬6.50</p>
                        </div>
                        <div class="option-card" data-type="size" data-name="Large" data-price="2" data-size="large">
                            <img src="https://images.unsplash.com/photo-1574071318508-1cdbab80d002?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Large">
                            <h3>Large</h3>
                            <p>+â‚¬2.00</p>
                        </div>
                        <div class="option-card" data-type="size" data-name="Extra Large" data-price="3.5" data-size="xl">
                            <img src="https://images.unsplash.com/photo-1595854341625-f33ee10dbf94?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="Extra Large">
                            <h3>Extra Large</h3>
                            <p>+â‚¬3.50</p>
                        </div>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn" id="prevBtn" disabled>Previous</button>
                    <button class="btn btn-primary" id="nextBtn">Next: Choose Sauce</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Cart Panel -->
    <div class="cart-panel">
        <div class="cart-header">
            <h2>Your Order</h2>
            <button class="close-cart">Ã—</button>
        </div>
        <div class="cart-items">
            <div class="empty-cart">
                <div>ðŸ›’</div>
                <p>Your cart is empty</p>
            </div>
        </div>
        <div class="cart-summary">
            <div class="summary-row">
                <span>Subtotal:</span>
                <span class="cart-subtotal">â‚¬0.00</span>
            </div>
            <div class="summary-row">
                <span>Delivery fee:</span>
                <span class="delivery-fee">â‚¬2.50</span>
            </div>
            <div class="summary-row summary-total">
                <span>Total:</span>
                <span class="cart-total">â‚¬2.50</span>
            </div>
            <button class="checkout-btn">Proceed to Checkout</button>
        </div>
    </div>

    <!-- Login Dialog -->
    <dialog id="loginDialog">
        <button class="close-btn" aria-label="Sulje">âœ•</button>
        <form method="dialog" class="login-form">
            <h2>Log in</h2>
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" minlength="3" required>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" pattern=".+@metropolia\.fi$" required>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password"
                pattern="(?=.*[A-Z])(?=.*[0-9]).{6,}" required>
            <menu>
                <button value="cancel" class="cancel-btn">Cancel</button>
                <button value="submit" class="submit-btn">Log in</button>
            </menu>
        </form>
    </dialog>

    <!-- Sign Up Dialog -->
    <dialog id="signupDialog">
        <button class="close-btn" aria-label="Close">âœ•</button>
        <form method="dialog" class="signup-form">
            <h2>Sign up</h2>
            <div class="form-row">
                <div>
                    <label for="signup-name">First Name:</label>
                    <input type="text" id="signup-name" name="signup-name" minlength="2" required>
                </div>
                <div>
                    <label for="signup-surname">Last Name:</label>
                    <input type="text" id="signup-surname" name="signup-surname" minlength="2" required>
                </div>
            </div>
            <label for="signup-age">Age:</label>
            <input type="number" id="signup-age" name="signup-age" min="16" max="120" required>
            <label for="signup-email">Email:</label>
            <input type="email" id="signup-email" name="signup-email" pattern=".+@metropolia\.fi$" required>
            <p class="instructions">Must be a @metropolia.fi email address</p>
            <label for="signup-password">Password:</label>
            <input type="password" id="signup-password" name="signup-password"
                pattern="(?=.*[A-Z])(?=.*[0-9]).{6,}" required>
            <p class="instructions">Must contain at least one uppercase letter, one number, and be at least 6 characters long</p>
            <menu>
                <button value="cancel" class="cancel-btn">Cancel</button>
                <button value="submit" class="submit-btn">Sign up</button>
            </menu>
        </form>
    </dialog>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

</body>
</html>